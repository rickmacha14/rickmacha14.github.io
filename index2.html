<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Event Suitability Analysis - GIS & RS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Leaflet + Draw + Routing CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet-draw/dist/leaflet.draw.css"/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css"/>

  <style>
    body { margin:0; font-family: Arial, sans-serif; }
    #map { height: 100vh; width: 70%; float: left; }
    #sidebar {
      width: 30%; height: 100vh; float: right;
      background: #f8f9fa; padding: 15px;
      box-shadow: -2px 0 5px rgba(0,0,0,0.1);
      overflow-y: auto;
    }
    #sidebar h2 { margin-top: 0; color: #1abc9c; }
    .result-box {
      background: #fff; padding: 10px; margin-bottom: 10px;
      border-radius: 6px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    input, select, button {
      width: 100%; padding: 8px; margin: 5px 0;
      border: 1px solid #ccc; border-radius: 5px;
    }
    button {
      background: #1abc9c; color: #fff; border: none; cursor: pointer;
    }
    button:hover { background: #16a085; }
  </style>
</head>
<body>

  <!-- Map -->
  <div id="map"></div>

  <!-- Sidebar -->
  <div id="sidebar">
    <h2>üìä Suitability Dashboard</h2>
    <p>Draw a polygon on the map to start analysis.</p>

    <div class="result-box"><strong>Area (ha):</strong> <span id="area">-</span></div>
    <div class="result-box"><strong>Population Density:</strong> <span id="pop">-</span></div>
    <div class="result-box"><strong>Distance to Roads:</strong> <span id="roads">-</span></div>
    <div class="result-box"><strong>Flood Risk:</strong> <span id="flood">-</span></div>
    <div class="result-box"><strong>Suitability Score:</strong> <span id="score">-</span></div>

    <hr>

    <h3>üó∫Ô∏è Basemap Layers</h3>
    <select id="basemapSelect" onchange="switchBasemap(this.value)">
      <option value="osm">OSM Streets</option>
      <option value="esri">Esri Satellite</option>
      <option value="google">Google Hybrid</option>
      <option value="topo">Topo Map</option>
    </select>

    <hr>

    <h3>üöó Get Directions</h3>
    <input type="text" id="start" placeholder="Start (lat,lng)" />
    <input type="text" id="end" placeholder="End (lat,lng)" />
    <button onclick="getRoute()">Show Route</button>
  </div>

  <!-- Leaflet + Draw + Turf + Routing JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-draw/dist/leaflet.draw.js"></script>
  <script src="https://unpkg.com/@turf/turf/turf.min.js"></script>
  <script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>

  <script>
    let map;
    let currentBase;
    let routingControl;

    // Basemaps
    const baseLayers = {
      osm: L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '¬© OSM' }),
      esri: L.tileLayer(
        'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', 
        { attribution: 'Tiles ¬© Esri' }),
      google: L.tileLayer(
        'https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}', 
        { attribution: '¬© Google' }),
      topo: L.tileLayer(
        'https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', 
        { attribution: '¬© OpenTopoMap' })
    };

    // Initialize Map
    map = L.map('map', {
      center: [-6.82, 39.2], // Dar es Salaam default
      zoom: 12,
      layers: [baseLayers.osm]
    });
    currentBase = baseLayers.osm;

    // Drawn items
    var drawnItems = new L.FeatureGroup();
    map.addLayer(drawnItems);

    // Draw controls
    var drawControl = new L.Control.Draw({
      draw: { polygon:true, rectangle:true, polyline:false, circle:false, marker:false },
      edit: { featureGroup: drawnItems }
    });
    map.addControl(drawControl);

    // Placeholder Analysis
    function runAnalysis(layer) {
      var geojson = layer.toGeoJSON();
      var area = turf.area(geojson) / 10000; // hectares

      // Demo values (replace with GEE later)
      var pop = (Math.random()*500).toFixed(0);
      var roads = (Math.random()*1000).toFixed(0);
      var flood = (Math.random()*100).toFixed(1);
      var score = (Math.random()*100).toFixed(1);

      document.getElementById('area').innerText = area.toFixed(2);
      document.getElementById('pop').innerText = pop + " people/km¬≤";
      document.getElementById('roads').innerText = roads + " m";
      document.getElementById('flood').innerText = flood + "% risk";
      document.getElementById('score').innerText = score + "%";
    }

    // When polygon is created
    map.on(L.Draw.Event.CREATED, function(e) {
      var layer = e.layer;
      drawnItems.addLayer(layer);
      runAnalysis(layer);
    });

    // Switch Basemap
    function switchBasemap(type) {
      if (currentBase) map.removeLayer(currentBase);
      currentBase = baseLayers[type];
      map.addLayer(currentBase);
    }

    // Show Route
    function getRoute() {
      let start = document.getElementById('start').value.split(',').map(Number);
      let end = document.getElementById('end').value.split(',').map(Number);

      if (start.length !== 2 || end.length !== 2) {
        alert("Please enter valid coordinates like: -6.8,39.2");
        return;
      }

      if (routingControl) map.removeControl(routingControl);

      routingControl = L.Routing.control({
        waypoints: [
          L.latLng(start[0], start[1]),
          L.latLng(end[0], end[1])
        ],
        routeWhileDragging: true
      }).addTo(map);
    }
  </script>
</body>
</html>


